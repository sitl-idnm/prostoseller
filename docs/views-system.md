# Система подсчета просмотров (Глобальная)

## Описание

Система подсчета просмотров теперь работает с серверной синхронизацией. Все пользователи видят одинаковые счетчики просмотров, которые увеличиваются при посещении статей.

## Как это работает

### API Endpoints

- **GET /api/views?postId=slug** - получение количества просмотров для статьи
- **POST /api/views** - увеличение счетчика просмотров

### Хук useServerViews

Хук `useServerViews` принимает два параметра:
- `postId` - уникальный идентификатор статьи
- `initialViews` - начальное количество просмотров (fallback)

### Логика подсчета

1. **Загрузка данных**: При загрузке страницы данные загружаются с сервера
2. **Увеличение счетчика**: При посещении статьи счетчик увеличивается на 1
3. **Защита от накрутки**: Счетчик увеличивается не чаще чем раз в 30 минут
4. **Синхронизация**: Все пользователи видят одинаковые данные

### Пример использования

```tsx
import { useServerViews } from '@/shared/hooks/useServerViews'
import { formatViews } from '@/shared/utils/formatViews'

const BlogPost = ({ currentId, views }) => {
  const { views: currentViews, isLoading, error } = useServerViews(currentId, views)

  if (isLoading) return <div>Загрузка...</div>
  if (error) return <div>Ошибка загрузки</div>

  return (
    <div>
      Просмотров: {formatViews(currentViews)}
    </div>
  )
}
```

## Структура данных

### Файл data/views.json
```json
{
  "article-slug": {
    "views": 1234,
    "lastUpdated": 1703123456789
  }
}
```

### API Response
```json
{
  "views": 1234,
  "incremented": true
}
```

## Особенности

- **Глобальная синхронизация**: Все пользователи видят одинаковые счетчики
- **Защита от накрутки**: Ограничение по времени между обновлениями
- **Fallback**: При ошибках используется начальное значение
- **Производительность**: Минимальные запросы к серверу
- **Надежность**: Обработка ошибок и fallback значения

## Начальные значения просмотров

Текущие значения просмотров в статьях:

1. **Зимние товары** - 2,345 просмотров
2. **Осенние товары** - 2,217 просмотров
3. **Приоритет складов Озон** - 4,106 просмотров
4. **Подключение ЭДО** - 2,604 просмотра
5. **Самые продаваемые товары** - 3,891 просмотр
6. **Сезонные товары на маркетплейсах** - 1,892 просмотра
7. **Как отгрузить товар на Озон** - 2,165 просмотров
8. **Где находятся склады Ozon** - 4,327 просмотров
9. **Требования к упаковке** - 7,122 просмотра

## Переход с локальной системы

Если нужно вернуться к локальной системе (каждый пользователь видит свой счетчик), замените:

```tsx
// Вместо
import { useServerViews } from '@/shared/hooks/useServerViews'
const { views: currentViews } = useServerViews(currentId, views)

// Используйте
import { useViews } from '@/shared/hooks/useViews'
const currentViews = useViews(currentId, views)
```
